# 统一配置管理方案

## 1. 方案概述

将所有程序的配置集中到一个`all.ini`文件中，实现配置的统一管理。

## 2. 配置文件结构设计

### 2.1 all.ini文件结构

```ini
[general]
# 通用配置

[vm_management]
# 虚拟机管理配置
target_vm_name = XMG5100丛雨2.112
target_vm_snapshot = NMC3.16.0
ip_address = 10.156.2.112/15
default_gateway = 10.157.255.254
current_kb_package = Wlan-2025111403
customer_config = D:\Users\SXF-Admin\Desktop\新建文件夹 (2)\2026_01_28_102600.bcf
login_username = admin
login_password = Qwer1234
hci_ip = 10.156.1.50
hci_username = admin
hci_password = Msgt@202601

[kb_compare]
# KB系统配置
kb_username = 谭俊杰59272
kb_password = Qwer1234
history_packages = KB-NACAP-20250716-zhaohang-daping-wns3.15.0-CAxxx-001,KB-NACAP-20250716-zhaohang-daping-wns3.15.0-CAyyy-002
pending_packages = KB-NACAP-Wlan-2025101501-001,KB-NACAP-Wlan-2025101502-001

[kb_test]
# KB下载测试配置
kb_number = KB-WACAP-20260114-Wlan-2025121901
target_id = nm8

[kb_scan_report]
# KB扫描报告配置
username = 59272
password = Qwer1234
kb_package = KB-WACAP-20260114-Wlan-2025121901-nm5.tgz
```

## 3. 实现方案

### 3.1 方案选择

**推荐方案：直接读取统一配置**

- **简化配置管理**：所有配置集中在一个文件，便于管理和修改
- **减少配置冗余**：避免多个配置文件的重复和不一致
- **提高可维护性**：配置变更时只需修改一个文件
- **降低出错概率**：避免配置不同步导致的错误

### 3.2 实施步骤

1. **创建all.ini文件**：按照设计结构填写所有配置
2. **修改各程序**：
   - vm_management_workflow.py：修改配置读取逻辑，从all.ini读取
   - KB_compare.py：修改配置读取逻辑，从all.ini读取，支持逗号分隔的多个包
   - test_KB.py：修改配置读取逻辑，从all.ini读取
   - KB_scan_report.py：修改配置读取逻辑，从all.ini读取
3. **测试验证**：确保所有程序能正确读取配置
4. **部署使用**：更新所有程序使用统一配置

## 4. 技术实现要点

- **使用configparser模块**：读取ini格式配置
- **支持多包配置**：对逗号分隔的包名列表进行解析
- **统一配置结构**：确保各程序配置项命名一致
- **向后兼容**：保留现有配置文件作为备份
- **错误处理**：添加配置读取失败的错误处理

## 5. 预期效果

- 所有程序使用统一的配置文件
- 配置修改后所有程序自动生效
- 支持多个历史包和待对比包的配置
- 减少配置错误和不一致
- 提高配置管理效率